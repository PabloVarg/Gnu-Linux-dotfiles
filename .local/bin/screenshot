#!/bin/sh

DIR="${HOME}/Screenshots"
DELAY=0.2

verify_dir () {
    [ -d $DIR ] || mkdir $DIR
}

ask_name () {
    d=$(date '+%y%m%d-%H%M-%S')
    name="$(prompt_open "File Name" "screenshot-${d}")"
}

prepare_location () {
    verify_dir
    ask_name
}

case "$(prompt_open "Screenshot" "Select area (copy)\nSelect area\nCurrent window (copy)\nCurrent window\nFull screen (copy)\nFull screen")" in
    "Select area (copy)")
        maim -su | xclip -selection clipboard -t image/png ;;
    "Select area")
        prepare_location
        maim -su "${DIR}/${name}.png" ;;
    "Current window (copy)")
        maim -ud $DELAY -i "$(printf '%d' "$(xprop -root _NET_ACTIVE_WINDOW | cut -d ' ' -f 5)")" | xclip -selection clipboard -t image/png ;;
    "Current window")
        prepare_location
        maim -ud $DELAY -i "$(printf '%d' "$(xprop -root _NET_ACTIVE_WINDOW | cut -d ' ' -f 5)")" "${DIR}/${name}.png" ;;
    "Full screen (copy)")
        maim -ud $DELAY | xclip -selection clipboard -t image/png ;;
    "Full screen")
        prepare_location
        maim -ud $DELAY "${DIR}/${name}.png"  ;;
esac
